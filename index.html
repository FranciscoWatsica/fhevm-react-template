<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Pet DNA Matching System</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5em;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 1.2em;
            color: #7f8c8d;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ee5a6f;
            box-shadow: 0 0 0 3px rgba(238, 90, 111, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #ee5a6f 0%, #f79c42 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(238, 90, 111, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #00d2d3 0%, #01a3a4 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .wallet-info {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .pet-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pet-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .pet-card:hover {
            border-color: #ee5a6f;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(238, 90, 111, 0.2);
        }

        .pet-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .pet-card p {
            color: #7f8c8d;
            margin: 5px 0;
        }

        .pet-card .pet-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .pet-card .btn {
            padding: 8px 15px;
            font-size: 14px;
        }

        .dna-markers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .marker {
            background: #fff5f5;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #ee5a6f;
        }

        .marker label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ee5a6f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .match-result {
            background: linear-gradient(135deg, #00d2d3 0%, #01a3a4 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
        }

        .match-result h3 {
            margin-bottom: 15px;
        }

        .compatibility-score {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .pet-list {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
                flex-direction: column;
            }

            .dna-markers {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                üß¨ Private Pet DNA Matching System
            </h1>
            <p>FHE-powered pet breeding platform that finds optimal breeding partners while protecting genetic privacy and preventing hereditary diseases</p>
        </div>

        <div id="walletSection" class="card">
            <h2>üîó Wallet Connection</h2>
            <div id="deploymentInfo" class="status success">
                <strong>‚úÖ Contract Deployed!</strong> Connected to Sepolia testnet.<br>
                <strong>Address:</strong> <code>0xC16ebe7Cb0A3B057437B8A3568d6Df2FB02812d1</code><br>
                <strong>Gateway:</strong> API v2.0+ Compatible | <strong>Network:</strong> Sepolia (Chain ID: 11155111)<br>
                <a href="https://sepolia.etherscan.io/address/0xC16ebe7Cb0A3B057437B8A3568d6Df2FB02812d1" target="_blank" style="color: #155724;">View on Etherscan ‚Üí</a>
            </div>
            <button id="connectWallet" class="btn">
                Connect MetaMask Wallet
            </button>
            <div id="walletInfo" class="wallet-info hidden">
                <p><strong>Address:</strong> <span id="walletAddress"></span></p>
                <p><strong>Balance:</strong> <span id="walletBalance"></span> ETH</p>
            </div>
        </div>

        <div id="registerSection" class="card">
            <h2>üêï Pet Registration</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="petName">Pet Name</label>
                    <input type="text" id="petName" placeholder="Enter pet name">
                </div>
                <div class="form-group">
                    <label for="petBreed">Breed</label>
                    <select id="petBreed">
                        <option value="">Select breed</option>
                        <option value="Golden Retriever">Golden Retriever</option>
                        <option value="Labrador Retriever">Labrador Retriever</option>
                        <option value="German Shepherd">German Shepherd</option>
                        <option value="Border Collie">Border Collie</option>
                        <option value="Poodle">Poodle</option>
                        <option value="Samoyed">Samoyed</option>
                        <option value="Siberian Husky">Siberian Husky</option>
                        <option value="Bichon Frise">Bichon Frise</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="petAge">Age</label>
                    <input type="number" id="petAge" min="1" max="20" placeholder="Age in years">
                </div>
            </div>

            <div class="dna-markers">
                <div class="marker">
                    <label for="marker1">Genetic Marker 1 (0-65535)</label>
                    <input type="number" id="marker1" min="0" max="65535" placeholder="Marker 1 value">
                </div>
                <div class="marker">
                    <label for="marker2">Genetic Marker 2 (0-65535)</label>
                    <input type="number" id="marker2" min="0" max="65535" placeholder="Marker 2 value">
                </div>
                <div class="marker">
                    <label for="marker3">Genetic Marker 3 (0-65535)</label>
                    <input type="number" id="marker3" min="0" max="65535" placeholder="Marker 3 value">
                </div>
                <div class="marker">
                    <label for="marker4">Temperament Seed (0-255)</label>
                    <input type="number" id="marker4" min="0" max="255" placeholder="Used to calculate temperament (1-10)">
                </div>
                <div class="marker">
                    <label for="healthRisk">Health Risk Score (0-100, lower is better)</label>
                    <input type="number" id="healthRisk" min="0" max="100" placeholder="Will be converted to health score">
                </div>
                <button id="randomDNA" class="btn btn-secondary" style="margin-top: 10px;">
                    üé≤ Generate Random DNA
                </button>
            </div>

            <button id="registerPet" class="btn" style="margin-top: 20px;">
                Register Pet
            </button>
        </div>

        <div id="myPetsSection" class="card">
            <h2>üè† My Pets</h2>
            <button id="loadMyPets" class="btn btn-secondary">
                Load My Pets
            </button>
            <div id="myPetsList" class="pet-list"></div>
        </div>

        <div id="matchingSection" class="card">
            <h2>üíï Matching Service</h2>
            <p style="margin-bottom: 15px;">Select two pets to request compatibility matching (Cost: 0.001 ETH)</p>
            <div class="form-grid">
                <div class="form-group">
                    <label for="matchPet1Select">Your Pet</label>
                    <select id="matchPet1Select">
                        <option value="">Please load your pets first</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="matchPet2Select">Match With Pet ID</label>
                    <input type="number" id="matchPet2Select" placeholder="Enter pet ID to match with" min="1">
                </div>
            </div>
            <button id="requestMatching" class="btn btn-success">
                Request Matching (0.001 ETH)
            </button>
            <div id="matchingResults"></div>
        </div>

        <div id="contractInfo" class="card">
            <h2>üìä Contract Information</h2>
            <button id="loadContractInfo" class="btn btn-secondary">
                Load Contract Info
            </button>
            <div id="contractInfoDisplay" style="margin-top: 15px;"></div>
        </div>

        <div id="status"></div>
    </div>

    <script>
        // Deployed Contract Address on Sepolia Testnet
        const CONTRACT_ADDRESS = "0xC16ebe7Cb0A3B057437B8A3568d6Df2FB02812d1";

        // Contract ABI - Updated for migrated contract
        const CONTRACT_ABI = [
            "function registerPet(string _name, string _species, string _breed, uint256 _birthYear, uint8 _healthScore, uint16 _geneticMarker1, uint16 _geneticMarker2, uint16 _geneticMarker3, uint8 _temperament)",
            "function requestMatching(uint256 _petId1, uint256 _petId2) payable",
            "function setBreedingStatus(uint256 _petId, bool _available)",
            "function getPetInfo(uint256 _petId) view returns (string name, string species, string breed, uint256 birthYear, address petOwner, bool availableForBreeding)",
            "function getOwnerPets(address _owner) view returns (uint256[])",
            "function getTotalPets() view returns (uint256)",
            "function matchingCost() view returns (uint256)",
            "function owner() view returns (address)",
            "event PetRegistered(uint256 indexed petId, address indexed owner, string name)",
            "event MatchingRequested(uint256 indexed petId1, uint256 indexed petId2, uint256 requestId)",
            "event MatchingCompleted(uint256 indexed petId1, uint256 indexed petId2, uint8 compatibilityScore)",
            "event BreedingStatusChanged(uint256 indexed petId, bool available)"
        ];

        let provider;
        let signer;
        let contract;
        let userAccount;

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            bindEventListeners();
        });

        async function initializeApp() {
            // Check if Ethers.js is loaded
            if (typeof ethers === 'undefined') {
                showStatus('Loading Ethers.js library...', 'info');
                // Try to reload ethers
                setTimeout(() => {
                    if (typeof ethers === 'undefined') {
                        showStatus('Ethers.js loading failed, please refresh the page', 'error');
                        return;
                    }
                    initializeApp();
                }, 1000);
                return;
            }

            // Check if MetaMask is installed
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Create provider
                    provider = new ethers.providers.Web3Provider(window.ethereum);

                    // Listen for account changes
                    window.ethereum.on('accountsChanged', handleAccountsChanged);
                    window.ethereum.on('chainChanged', handleChainChanged);

                    showStatus('MetaMask detected, please connect wallet to begin', 'info');
                } catch (error) {
                    console.error('Initialization error:', error);
                    showStatus('Initialization failed: ' + error.message, 'error');
                }
            } else {
                showStatus('Please install MetaMask wallet', 'error');
            }
        }

        function bindEventListeners() {
            document.getElementById('connectWallet').addEventListener('click', connectWallet);
            document.getElementById('registerPet').addEventListener('click', registerPet);
            document.getElementById('loadMyPets').addEventListener('click', loadMyPets);
            document.getElementById('requestMatching').addEventListener('click', requestMatching);
            document.getElementById('loadContractInfo').addEventListener('click', loadContractInfo);
            document.getElementById('randomDNA').addEventListener('click', generateRandomDNA);
        }

        async function connectWallet() {
            try {
                showLoading('connectWallet', true);

                // Request user authorization
                const accounts = await window.ethereum.request({
                    method: 'eth_requestAccounts'
                });

                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    signer = provider.getSigner();

                    // Check contract address
                    if (CONTRACT_ADDRESS === "YOUR_CONTRACT_ADDRESS_HERE") {
                        showStatus('Warning: Contract address not configured, please deploy contract first', 'info');
                    } else if (CONTRACT_ADDRESS === "0x1234567890123456789012345678901234567890") {
                        showStatus('Note: Currently using demo contract address, real functionality requires deploying actual contract', 'info');
                        // Still create contract instance for demo purposes, but will prompt user when calling
                        try {
                            contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                        } catch (error) {
                            showStatus('Contract connection failed, please check network and address', 'error');
                        }
                    } else {
                        // Create contract instance
                        contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    }

                    // Get balance
                    const balance = await provider.getBalance(userAccount);

                    // Update UI
                    document.getElementById('walletAddress').textContent =
                        userAccount.substring(0, 6) + '...' + userAccount.substring(38);
                    document.getElementById('walletBalance').textContent =
                        ethers.utils.formatEther(balance);

                    document.getElementById('walletInfo').classList.remove('hidden');

                    showStatus('Wallet connected successfully!', 'success');
                }
            } catch (error) {
                console.error('Wallet connection failed:', error);
                showStatus('Wallet connection failed: ' + error.message, 'error');
            } finally {
                showLoading('connectWallet', false);
            }
        }

        async function registerPet() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            try {
                showLoading('registerPet', true);

                const name = document.getElementById('petName').value.trim();
                const breed = document.getElementById('petBreed').value;
                const age = parseInt(document.getElementById('petAge').value);
                const marker1 = parseInt(document.getElementById('marker1').value);
                const marker2 = parseInt(document.getElementById('marker2').value);
                const marker3 = parseInt(document.getElementById('marker3').value);
                const marker4 = parseInt(document.getElementById('marker4').value);
                const healthRisk = parseInt(document.getElementById('healthRisk').value);

                // Validate input
                if (!name) {
                    throw new Error('Please enter pet name');
                }
                if (!breed) {
                    throw new Error('Please select pet breed');
                }
                if (!age || age <= 0 || age > 20) {
                    throw new Error('Please enter valid pet age (1-20 years)');
                }
                if (isNaN(marker1) || marker1 < 0 || marker1 > 65535) {
                    throw new Error('Genetic marker 1 must be a value between 0-65535');
                }
                if (isNaN(marker2) || marker2 < 0 || marker2 > 65535) {
                    throw new Error('Genetic marker 2 must be a value between 0-65535');
                }
                if (isNaN(marker3) || marker3 < 0 || marker3 > 65535) {
                    throw new Error('Genetic marker 3 must be a value between 0-65535');
                }
                if (isNaN(healthRisk) || healthRisk < 0 || healthRisk > 100) {
                    throw new Error('Health score must be a value between 0-100');
                }

                // Calculate birth year from age (contract requires 2000-2024)
                const currentYear = 2024; // Use 2024 as reference year for contract validation
                const birthYear = currentYear - age;

                // Default temperament score (1-10)
                const temperament = marker4 % 10 + 1;

                // Health score is inverted: lower risk = higher score
                const healthScore = 100 - healthRisk;

                // Species (default to Dog for simplicity)
                const species = "Dog";

                // Call contract to register pet with new parameters
                // registerPet(string _name, string _species, string _breed, uint256 _birthYear,
                //             uint8 _healthScore, uint16 _geneticMarker1, uint16 _geneticMarker2,
                //             uint16 _geneticMarker3, uint8 _temperament)
                const tx = await contract.registerPet(
                    name,
                    species,
                    breed,
                    birthYear,
                    healthScore,
                    marker1,
                    marker2,
                    marker3,
                    temperament
                );

                showStatus('Transaction sent, waiting for confirmation...', 'info');

                const receipt = await tx.wait();

                // Clear form
                clearRegistrationForm();

                showStatus(`Pet registration successful! Transaction hash: ${receipt.transactionHash}`, 'success');

                // Auto-load my pets
                setTimeout(() => loadMyPets(), 2000);

            } catch (error) {
                console.error('Pet registration failed:', error);
                showStatus('Pet registration failed: ' + (error.reason || error.message), 'error');
            } finally {
                showLoading('registerPet', false);
            }
        }

        async function loadMyPets() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            try {
                showLoading('loadMyPets', true);

                // Get user's pet ID list
                const petIds = await contract.getOwnerPets(userAccount);

                const myPetsList = document.getElementById('myPetsList');
                const matchPet1Select = document.getElementById('matchPet1Select');

                myPetsList.innerHTML = '';
                matchPet1Select.innerHTML = '<option value="">Select your pet</option>';

                if (petIds.length === 0) {
                    myPetsList.innerHTML = '<p>You haven\'t registered any pets yet</p>';
                    return;
                }

                // Get detailed information for each pet
                for (let i = 0; i < petIds.length; i++) {
                    const petId = petIds[i];
                    const petInfo = await contract.getPetInfo(petId);

                    const petCard = createPetCard(petId, petInfo);
                    myPetsList.appendChild(petCard);

                    // Add to matching dropdown options
                    const option = document.createElement('option');
                    option.value = petId.toString();
                    option.textContent = `#${petId} - ${petInfo.name} (${petInfo.breed})`;
                    matchPet1Select.appendChild(option);
                }

                showStatus(`Successfully loaded ${petIds.length} pets`, 'success');

            } catch (error) {
                console.error('Loading pets failed:', error);
                showStatus('Loading pets failed: ' + error.message, 'error');
            } finally {
                showLoading('loadMyPets', false);
            }
        }

        async function requestMatching() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            const petId1 = document.getElementById('matchPet1Select').value;
            const petId2 = document.getElementById('matchPet2Select').value;

            if (!petId1) {
                showStatus('Please select your pet', 'error');
                return;
            }
            if (!petId2) {
                showStatus('Please enter the pet ID to match with', 'error');
                return;
            }

            try {
                showLoading('requestMatching', true);

                // Get matching cost
                const matchingCost = await contract.matchingCost();

                // Request matching with payment
                const tx = await contract.requestMatching(petId1, petId2, {
                    value: matchingCost
                });

                showStatus('Matching request sent, waiting for confirmation...', 'info');

                const receipt = await tx.wait();
                showStatus('Matching request confirmed! Waiting for Gateway to process...', 'success');

                // Listen for matching result events
                contract.on('MatchingCompleted', (p1, p2, compatibilityScore) => {
                    if (p1.toString() === petId1 && p2.toString() === petId2) {
                        displayMatchResult(petId1, petId2, compatibilityScore);
                    }
                });

            } catch (error) {
                console.error('Matching request failed:', error);
                showStatus('Matching request failed: ' + (error.reason || error.message), 'error');
            } finally {
                showLoading('requestMatching', false);
            }
        }

        async function loadContractInfo() {
            if (!contract) {
                showStatus('Please connect wallet first', 'error');
                return;
            }

            try {
                showLoading('loadContractInfo', true);

                const totalPets = await contract.getTotalPets();
                const matchingCost = await contract.matchingCost();
                const contractOwner = await contract.owner();

                const infoDiv = document.getElementById('contractInfoDisplay');
                infoDiv.innerHTML = `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <p><strong>Contract Address:</strong> <code>${CONTRACT_ADDRESS}</code></p>
                        <p><strong>Total Pets Registered:</strong> ${totalPets.toString()}</p>
                        <p><strong>Matching Cost:</strong> ${ethers.utils.formatEther(matchingCost)} ETH</p>
                        <p><strong>Contract Owner:</strong> <code>${contractOwner}</code></p>
                        <p><strong>Network:</strong> Sepolia Testnet</p>
                        <p><strong>Gateway:</strong> API v2.0+ Compatible ‚úÖ</p>
                    </div>
                `;

                showStatus('Contract information loaded successfully', 'success');

            } catch (error) {
                console.error('Loading contract info failed:', error);
                showStatus('Loading contract info failed: ' + error.message, 'error');
            } finally {
                showLoading('loadContractInfo', false);
            }
        }

        async function toggleBreedingStatus(petId, currentStatus) {
            if (!contract) return;

            try {
                const newStatus = !currentStatus;
                const tx = await contract.setBreedingStatus(petId, newStatus);
                showStatus('Updating status...', 'info');

                await tx.wait();
                showStatus('Breeding status updated', 'success');

                // Reload pet list
                setTimeout(() => loadMyPets(), 1000);

            } catch (error) {
                console.error('Update breeding status failed:', error);
                showStatus('Update breeding status failed: ' + error.message, 'error');
            }
        }

        function createPetCard(petId, petInfo) {
            const card = document.createElement('div');
            card.className = 'pet-card';

            // Calculate age from birth year
            const currentYear = new Date().getFullYear();
            const age = currentYear - petInfo.birthYear;

            card.innerHTML = `
                <h3>${petInfo.name}</h3>
                <p><strong>Species:</strong> ${petInfo.species}</p>
                <p><strong>Breed:</strong> ${petInfo.breed}</p>
                <p><strong>Age:</strong> ${age} years old (born ${petInfo.birthYear})</p>
                <p><strong>Breeding Status:</strong> ${petInfo.availableForBreeding ? 'Available' : 'Not Available'}</p>
                <div class="pet-actions">
                    <button class="btn btn-warning" onclick="toggleBreedingStatus(${petId}, ${petInfo.availableForBreeding})">
                        ${petInfo.availableForBreeding ? 'Set Unavailable' : 'Set Available'}
                    </button>
                </div>
            `;

            return card;
        }

        function createAvailablePetCard(petId, petInfo) {
            const card = document.createElement('div');
            card.className = 'pet-card';

            // Calculate age from birth year
            const currentYear = new Date().getFullYear();
            const age = currentYear - petInfo.birthYear;

            card.innerHTML = `
                <h3>${petInfo.name}</h3>
                <p><strong>Species:</strong> ${petInfo.species}</p>
                <p><strong>Breed:</strong> ${petInfo.breed}</p>
                <p><strong>Age:</strong> ${age} years old (born ${petInfo.birthYear})</p>
                <p><strong>Owner:</strong> ${petInfo.petOwner.substring(0, 6)}...${petInfo.petOwner.substring(38)}</p>
            `;

            return card;
        }

        function displayMatchResult(petId1, petId2, compatibilityScore) {
            const matchingResults = document.getElementById('matchingResults');

            const resultDiv = document.createElement('div');
            resultDiv.className = 'match-result';

            resultDiv.innerHTML = `
                <h3>üéâ Matching Complete!</h3>
                <p><strong>Pet #${petId1}</strong> matched with <strong>Pet #${petId2}</strong></p>
                <div class="compatibility-score">${compatibilityScore}/100</div>
                <p>Compatibility score (higher is better for breeding)</p>
                <p style="font-size: 0.9em; margin-top: 10px;">
                    <strong>Note:</strong> All genetic data remains encrypted throughout the matching process.
                </p>
            `;

            matchingResults.appendChild(resultDiv);
        }

        function clearRegistrationForm() {
            document.getElementById('petName').value = '';
            document.getElementById('petBreed').value = '';
            document.getElementById('petAge').value = '';
            document.getElementById('marker1').value = '';
            document.getElementById('marker2').value = '';
            document.getElementById('marker3').value = '';
            document.getElementById('marker4').value = '';
            document.getElementById('healthRisk').value = '';
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;

            // 3ÁßíÂêéËá™Âä®Ê∏ÖÈô§ÊàêÂäüÊ∂àÊÅØ
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, 3000);
            }
        }

        function showLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (loading) {
                button.disabled = true;
                button.innerHTML = '<div class="loading"></div> Processing...';
            } else {
                button.disabled = false;
                // Restore original button text
                switch(buttonId) {
                    case 'connectWallet':
                        button.innerHTML = 'Connect MetaMask Wallet';
                        break;
                    case 'registerPet':
                        button.innerHTML = 'Register Pet';
                        break;
                    case 'loadMyPets':
                        button.innerHTML = 'Load My Pets';
                        break;
                    case 'requestMatching':
                        button.innerHTML = 'Start Matching';
                        break;
                    case 'loadAvailablePets':
                        button.innerHTML = 'View Available Pets';
                        break;
                }
            }
        }

        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                // User disconnected wallet
                userAccount = null;
                contract = null;
                document.getElementById('walletInfo').classList.add('hidden');
                showStatus('Wallet disconnected', 'info');
            } else if (accounts[0] !== userAccount) {
                // User switched accounts
                userAccount = accounts[0];
                connectWallet();
            }
        }

        function handleChainChanged(chainId) {
            // Reload page when network changes
            window.location.reload();
        }

        // Generate random DNA marker values (for demo)
        function generateRandomDNA() {
            document.getElementById('marker1').value = Math.floor(Math.random() * 65536);
            document.getElementById('marker2').value = Math.floor(Math.random() * 65536);
            document.getElementById('marker3').value = Math.floor(Math.random() * 65536);
            document.getElementById('marker4').value = Math.floor(Math.random() * 256);
            document.getElementById('healthRisk').value = Math.floor(Math.random() * 50); // Lower health risk (better health)
            showStatus('Random DNA markers generated', 'success');
        }

        // Add toggleBreedingStatus function to global scope
        window.toggleBreedingStatus = toggleBreedingStatus;
    </script>
</body>
</html>
